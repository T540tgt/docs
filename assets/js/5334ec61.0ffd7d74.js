"use strict";(self.webpackChunkdocs_oasis_io=self.webpackChunkdocs_oasis_io||[]).push([[8025],{8316:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var t=i(4848),s=i(8453);const r={},o="Building",l={id:"core/development-setup/building",title:"Building",description:"This chapter contains a description of steps required to build Oasis Core.",source:"@site/docs/core/development-setup/building.md",sourceDirName:"core/development-setup",slug:"/core/development-setup/building",permalink:"/core/development-setup/building",draft:!1,unlisted:!1,editUrl:"https://github.com/oasisprotocol/oasis-core/edit/stable/22.2.x/docs/development-setup/building.md",tags:[],version:"current",lastUpdatedAt:1715584634e3,frontMatter:{},sidebar:"oasisCore",previous:{title:"Prerequisites",permalink:"/core/development-setup/prerequisites"},next:{title:"Running Tests and Development Networks",permalink:"/core/development-setup/running-tests-and-development-networks"}},d={},a=[{value:"Unsafe Non-SGX Environment",id:"unsafe-non-sgx-environment",level:2},{value:"SGX Environment",id:"sgx-environment",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"building",children:"Building"}),"\n",(0,t.jsxs)(n.p,{children:["This chapter contains a description of steps required to build Oasis Core.\nBefore proceeding, make sure to look at the ",(0,t.jsx)(n.a,{href:"/core/development-setup/prerequisites",children:"prerequisites"})," required for running\nan Oasis Core environment."]}),"\n",(0,t.jsx)(n.h2,{id:"unsafe-non-sgx-environment",children:"Unsafe Non-SGX Environment"}),"\n",(0,t.jsx)(n.p,{children:"To build everything required for running an Oasis node locally, simply execute\nthe following in the top-level directory:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'export OASIS_UNSAFE_SKIP_AVR_VERIFY="1"\nexport OASIS_UNSAFE_SKIP_KM_POLICY="1"\nexport OASIS_UNSAFE_ALLOW_DEBUG_ENCLAVES="1"\nmake\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To build BadgerDB without ",(0,t.jsx)(n.code,{children:"jemalloc"})," support (and avoid installing ",(0,t.jsx)(n.code,{children:"jemalloc"}),"\non your system), set"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'export OASIS_BADGER_NO_JEMALLOC="1"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Not using ",(0,t.jsx)(n.code,{children:"jemalloc"})," is fine for development purposes."]}),"\n",(0,t.jsx)(n.p,{children:"This will build all the required parts (build tools, Oasis node, runtime\nlibraries, runtime loader, key manager and test runtimes). The AVR and KM flags\nare supported on production SGX systems only and these features must be disabled\nin our environment."}),"\n",(0,t.jsx)(n.h2,{id:"sgx-environment",children:"SGX Environment"}),"\n",(0,t.jsx)(n.p,{children:"Compilation procedure under SGX environment is similar to the non-SGX with\nslightly different environmental variables set:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'export OASIS_UNSAFE_SKIP_AVR_VERIFY="1"\nexport OASIS_UNSAFE_ALLOW_DEBUG_ENCLAVES="1"\nmake\n'})}),"\n",(0,t.jsx)(n.p,{children:"The AVR flag is there because we are running the node in a local development\nenvironment and we will not do any attestation with Intel's remote servers. The\ndebug enclaves flag allows enclaves in debug mode to be used."}),"\n",(0,t.jsx)(n.p,{children:"To run an Oasis node under SGX make sure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Your hardware has SGX support."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You either explicitly enabled SGX in BIOS or made a\n",(0,t.jsx)(n.code,{children:"sgx_cap_enable_device()"})," system call, if SGX is in software controlled state."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["You installed ",(0,t.jsx)(n.a,{href:"https://github.com/intel/linux-sgx-driver",children:"Intel's SGX driver"})," (check that ",(0,t.jsx)(n.code,{children:"/dev/isgx"})," exists)."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"You have the AESM daemon running. The easiest way is to just run it in a\nDocker container by doing (this will keep the container running and it will\nbe automatically started on boot):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker run \\\n  --detach \\\n  --restart always \\\n  --device /dev/isgx \\\n  --volume /var/run/aesmd:/var/run/aesmd \\\n  --name aesmd \\\n  ghcr.io/oasisprotocol/aesmd:master\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"sgx-detect"})," (part of fortanix rust tools) to verify that everything is\nconfigured correctly."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);